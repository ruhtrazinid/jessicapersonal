<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Montar Treino</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0a0a14; color: white; margin: 0; display: flex; height: 100vh; }
        
        .sidebar { width: 300px; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1); padding: 20px; overflow-y: auto; }
        .ex-item { background: rgba(255,255,255,0.1); padding: 10px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; transition: 0.3s; border: 1px solid transparent; }
        .ex-item:hover { border-color: #ff4fa3; background: rgba(255,79,163,0.1); }
        .ex-item img { width: 100%; border-radius: 4px; margin-top: 5px; }

        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .header { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; background: #1a1a2e; border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 8px; }
        
        .grid-dias { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .dia-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border-top: 3px solid #ff4fa3; min-height: 150px; }
        .dia-card h4 { margin-top: 0; color: #ff4fa3; text-transform: capitalize; }
        
        .ex-selecionado { background: #ff4fa3; color: white; padding: 5px 10px; border-radius: 4px; margin-bottom: 5px; font-size: 12px; display: flex; justify-content: space-between; }
        .remove-btn { cursor: pointer; font-weight: bold; }

        .btn-salvar { background: #ff4fa3; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-weight: bold; cursor: pointer; float: right; margin-top: 20px; font-size: 16px; transition: 0.3s; }
        .btn-salvar:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,79,163,0.4); }
    </style>
</head>
<body>

    <div class="sidebar">
        <h3>üí™ Exerc√≠cios</h3>
        <p><small>Selecione o dia no painel e clique no exerc√≠cio para adicionar:</small></p>
        
        <div class="ex-item" onclick="adicionarEx('Supino Reto', 'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExNHJueXF4ZzR6ZzR6ZzR6ZzR6ZzR6ZzR6ZzR6ZzR6ZzR6JmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1n/3o7TKMGpxx6V0Qv93G/giphy.gif')">
            <span>Supino Reto</span>
        </div>
        <div class="ex-item" onclick="adicionarEx('Abdominais', 'img/Abdominais.gif')">
            <span>Abdominais</span>
        </div>
    </div>

    <div class="main">
        <div class="header">
            <h2>‚öôÔ∏è Montar Treino Personalizado</h2>
            <input type="email" id="alunoEmail" placeholder="E-mail exato do aluno (ex: arthur@email.com)">
            <select id="diaAtual">
                <option value="segunda">Segunda-feira</option>
                <option value="terca">Ter√ßa-feira</option>
                <option value="quarta">Quarta-feira</option>
                <option value="quinta">Quinta-feira</option>
                <option value="sexta">Sexta-feira</option>
            </select>
            <textarea id="obsGeral" rows="3" placeholder="Observa√ß√µes e dicas para o aluno..."></textarea>
        </div>

        <div class="grid-dias">
            <div class="dia-card"><h4>Segunda</h4><div id="lista-segunda"></div></div>
            <div class="dia-card"><h4>Ter√ßa</h4><div id="lista-terca"></div></div>
            <div class="dia-card"><h4>Quarta</h4><div id="lista-quarta"></div></div>
            <div class="dia-card"><h4>Quinta</h4><div id="lista-quinta"></div></div>
            <div class="dia-card"><h4>Sexta</h4><div id="lista-sexta"></div></div>
        </div>

        <div id="treinoPDF" style="background:white;color:black;padding:20px;display:none;">
            <h2>üèãÔ∏è Treino Personalizado</h2>
            <p id="pdfEmail"></p>
            <p id="pdfObs"></p>
            <div id="pdfConteudo"></div>
        </div>

        <button class="btn-salvar" id="btnSalvar">üöÄ Publicar Treino</button>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyAKLvhy6r6tLSMIEt-mZcfHWuiKHHibdcY",
  authDomain: "meusiteteste1-7b880.firebaseapp.com",
  projectId: "meusiteteste1-7b880",
  storageBucket: "meusiteteste1-7b880.appspot.com",
  messagingSenderId: "107598819774",
  appId: "1:107598819774:web:1e369753c4b7908a6209ef"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// Estado local do treino
let treinoData = { segunda: [], terca: [], quarta: [], quinta: [], sexta: [] };

window.adicionarEx = (nome, arquivo) => {
    const dia = document.getElementById('diaAtual').value;
    treinoData[dia].push({ nome, arquivo });
    renderizar();
};

window.removerEx = (dia, index) => {
    treinoData[dia].splice(index, 1);
    renderizar();
};

function renderizar() {
    const dias = ['segunda', 'terca', 'quarta', 'quinta', 'sexta'];
    dias.forEach(dia => {
        const container = document.getElementById(`lista-${dia}`);
        container.innerHTML = treinoData[dia].map((ex, i) => `
            <div class="ex-selecionado">
                ${ex.nome} <span class="remove-btn" onclick="removerEx('${dia}', ${i})">‚úï</span>
            </div>
        `).join('');
    });
}

function gerarHTMLTreino(email, obs, dados) {
    let html = "";

    for (let dia in dados) {
        if (dados[dia].length > 0) {
            html += `<h3>${dia.toUpperCase()}</h3><ul>`;
            dados[dia].forEach(ex => {
                html += `<li>${ex.nome}</li>`;
            });
            html += "</ul>";
        }
    }

    document.getElementById("pdfEmail").innerText = "Aluno: " + email;
    document.getElementById("pdfObs").innerText = "Observa√ß√µes: " + obs;
    document.getElementById("pdfConteudo").innerHTML = html;
}

document.getElementById('btnSalvar').onclick = async () => {
    const email = document.getElementById('alunoEmail').value.toLowerCase().trim();
    const obs = document.getElementById('obsGeral').value;

    if (!email) return alert("Digite o e-mail do aluno!");

    try {
        gerarHTMLTreino(email, obs, treinoData);

        const elemento = document.getElementById("treinoPDF");

        const pdfBlob = await html2pdf().from(elemento).outputPdf('blob');

        const pdfRef = ref(storage, `treinos/${email}.pdf`);
        await uploadBytes(pdfRef, pdfBlob);

        const pdfUrl = await getDownloadURL(pdfRef);

        const treinoRef = doc(db, "treinos", email);

        await setDoc(treinoRef, {
            instrucoes: obs,
            cronograma: treinoData,
            pdfUrl: pdfUrl,
            dataAtualizacao: new Date().toISOString()
        });

        alert("üî• Treino enviado com PDF para " + email);

    } catch (e) {
        console.error(e);
        alert("Erro ao salvar treino. Verifique o console.");
    }
};
</script>
</body>
</html>
