<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√Årea do Aluno ‚Ä¢ J√©ssica Personal</title>
<link rel="icon" href="logo.ico">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  :root {
    --primary: #ff4fa3;
    --secondary: #ff1f6d;
    --glass-bg: rgba(20, 10, 20, 0.7);
    --glass-border: rgba(255, 255, 255, 0.1);
    --card-bg: rgba(255, 255, 255, 0.03);
    --sidebar-width: 260px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Outfit', sans-serif; }

  body {
    display: none; 
    background: linear-gradient(-45deg, #0a0a14, #180511, #2a0a1f, #12000b);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #fff;
    min-height: 100vh;
    overflow-x: hidden;
  }

  @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

  /* SIDEBAR */
  .sidebar {
    width: var(--sidebar-width);
    background: rgba(15, 10, 15, 0.8);
    border-right: 1px solid var(--glass-border);
    backdrop-filter: blur(20px);
    padding: 25px;
    position: fixed;
    height: 100vh;
    display: flex;
    flex-direction: column;
    z-index: 100;
    transition: 0.3s;
  }

  .brand {
    font-size: 20px; font-weight: 700; color: #fff; margin-bottom: 40px;
    display: flex; align-items: center; gap: 10px;
  }
  .brand i { color: var(--primary); }

  .menu-item {
    display: flex; align-items: center; gap: 12px;
    padding: 14px 16px; margin-bottom: 8px;
    border-radius: 12px; cursor: pointer;
    color: rgba(255,255,255,0.6);
    transition: 0.3s; font-size: 14px; font-weight: 500;
  }
  .menu-item:hover, .menu-item.active {
    background: rgba(255, 79, 163, 0.15); color: #fff;
  }
  .menu-item.active { border-left: 3px solid var(--primary); }

  .sidebar-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--glass-border); }
  .logout-btn {
    width: 100%; padding: 12px; background: rgba(255, 23, 68, 0.1);
    color: #ff1744; border: 1px solid rgba(255, 23, 68, 0.2);
    border-radius: 10px; cursor: pointer; font-weight: 600;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    transition: 0.3s;
  }
  .logout-btn:hover { background: rgba(255, 23, 68, 0.2); }

  /* MAIN CONTENT */
  .main {
    flex: 1; margin-left: var(--sidebar-width); padding: 30px;
    width: calc(100% - var(--sidebar-width));
    transition: 0.3s;
  }

  /* HEADER MOBILE */
  .mobile-header {
    display: none;
    align-items: center; justify-content: space-between;
    padding: 15px 20px; background: rgba(15, 10, 15, 0.9);
    backdrop-filter: blur(10px); border-bottom: 1px solid var(--glass-border);
    position: sticky; top: 0; z-index: 90;
  }
  .menu-toggle { font-size: 24px; cursor: pointer; background: none; border: none; color: #fff; }

  /* DASHBOARD CARDS */
  .welcome-box { margin-bottom: 30px; }
  .welcome-box h2 { font-size: 28px; font-weight: 700; margin-bottom: 5px; }
  .welcome-box p { opacity: 0.7; font-size: 14px; }

  /* ESTILOS DAS TABELAS DIN√ÇMICAS */
  .treino-container { display: flex; flex-direction: column; gap: 25px; }
  
  .day-card {
    background: var(--card-bg); border: 1px solid var(--glass-border);
    border-radius: 20px; padding: 25px; backdrop-filter: blur(10px);
    animation: fadeInUp 0.5s ease;
  }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  .day-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 12px;
  }
  .day-header h3 { color: var(--primary); font-size: 22px; font-weight: 700; text-transform: capitalize; }
  
  .table-responsive { overflow-x: auto; width: 100%; border-radius: 12px; }
  
  .treino-table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 600px; }
  .treino-table th { text-align: left; padding: 15px; color: rgba(255,255,255,0.4); font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; border-bottom: 1px solid var(--glass-border); }
  .treino-table td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); color: rgba(255,255,255,0.9); }
  .treino-table tr:hover td { background: rgba(255,255,255,0.02); }
  .ex-nome { font-weight: 700; color: #fff; font-size: 15px; }
  
  .obs-geral { 
    background: rgba(255, 79, 163, 0.1); padding: 20px; border-radius: 15px; 
    border: 1px solid rgba(255, 79, 163, 0.2); margin-bottom: 30px; 
    font-size: 14px; display: flex; gap: 15px; align-items: flex-start;
  }
  .obs-geral i { color: var(--primary); font-size: 18px; margin-top: 2px; }

  /* OVERLAY MOBILE */
  .overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.7);
    opacity: 0; pointer-events: none; transition: 0.3s; z-index: 99;
  }
  .overlay.active { opacity: 1; pointer-events: all; }

  @media (max-width: 900px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.active { transform: translateX(0); }
    .main { margin-left: 0; width: 100%; padding: 20px; }
    .mobile-header { display: flex; }
    .day-card { padding: 15px; }
  }
</style>
</head>
<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="sidebar" id="sidebar">
  <div class="brand">
    <i class="fa-solid fa-bolt"></i>
    <span>√Årea do Aluno</span>
  </div>

  <div class="menu-item active">
    <i class="fa-solid fa-dumbbell"></i>
    <span>Meu Treino</span>
  </div>
  
  <div class="menu-item" onclick="window.open('https://wa.link/iv0wso', '_blank')"
    <i class="fa-brands fa-whatsapp"></i>
    <span>Suporte</span>
  </div>

  <div class="sidebar-footer">
    <button class="logout-btn" onclick="logout()">
      <i class="fa-solid fa-right-from-bracket"></i>
      <span>Sair</span>
    </button>
  </div>
</div>

<div class="mobile-header">
  <button class="menu-toggle" onclick="toggleMenu()"><i class="fa-solid fa-bars"></i></button>
  <div style="font-weight: 700;">J√©ssica Personal</div>
  <div style="width: 24px;"></div> 
</div>

<div class="main">
  
  <div class="welcome-box">
    <h2 id="userName">üëã Seja Bem-Vindo!</h2>
    <p id="userPlano">Segue abaixo o seu treino personalizado:</p>
  </div>

  <div id="treinoDinamico" class="treino-container">
      <div style="text-align: center; padding: 50px; opacity: 0.5;">
          <i class="fa-solid fa-spinner fa-spin" style="font-size: 30px; margin-bottom: 10px;"></i>
          <p>Buscando sua ficha de treino...</p>
      </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import { getFirestore, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAKLvhy6r6tLSMIEt-mZcfHWuiKHHibdcY",
  authDomain: "meusiteteste1-7b880.firebaseapp.com",
  projectId: "meusiteteste1-7b880",
  storageBucket: "meusiteteste1-7b880.appspot.com",
  messagingSenderId: "107598819774",
  appId: "1:107598819774:web:1e369753c4b7908a6209ef"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  document.body.style.display = "block";
  const userEmail = user.email.toLowerCase();

  // 1. Dados B√°sicos do Aluno
  const userRef = doc(db, "users", user.uid);
  try {
    const userSnap = await getDoc(userRef);
    if (userSnap.exists()) {
      const data = userSnap.data();
      document.getElementById("userName").innerText = "üëã Ol√°, " + (data.nome || "Aluno");
      document.getElementById("userPlano").innerText = "Plano: " + (data.plano || "Consultoria");
    }
  } catch (e) { console.error("Erro ao carregar dados do usu√°rio"); }

  // 2. ESCUTA O TREINO EM TEMPO REAL COM ORDEM CORRETA
  const treinoRef = doc(db, "treinos", userEmail);
  
  onSnapshot(treinoRef, (docSnap) => {
    const container = document.getElementById("treinoDinamico");
    container.innerHTML = ""; 

    if (docSnap.exists()) {
      const data = docSnap.data();
      const cronograma = data.cronograma;

      // Recado da Personal
      if(data.obsGeral && data.obsGeral.trim() !== "") {
        container.innerHTML += `
          <div class="obs-geral">
            <i class="fa-solid fa-circle-info"></i>
            <div>
              <strong>Recado da J√©ssica:</strong><br>
              ${data.obsGeral}
            </div>
          </div>
        `;
      }

      // --- CORRE√á√ÉO DA ORDEM DOS DIAS ---
      const ordemDias = ["segunda", "terca", "quarta", "quinta", "sexta", "sabado"];
      const diasNomes = {
        segunda: "Segunda-feira",
        terca: "Ter√ßa-feira",
        quarta: "Quarta-feira",
        quinta: "Quinta-feira",
        sexta: "Sexta-feira",
        sabado: "S√°bado"
      };

      let encontrouTreino = false;

      // Percorre a lista na ordem que definimos acima
      ordemDias.forEach(diaKey => {
        const exercicios = cronograma[diaKey];
        
        if(exercicios && exercicios.length > 0) {
          encontrouTreino = true;
          
          let linhasTabela = exercicios.map(ex => `
            <tr>
              <td class="ex-nome">${ex.nome}</td>
              <td>${ex.series || "-"}</td>
              <td>${ex.reps || "-"}</td>
              <td>${ex.carga || "-"}</td>
              <td>${ex.descanso || "-"}</td>
              <td style="font-size:12px; font-style:italic; opacity:0.7;">${ex.obs || ""}</td>
            </tr>
          `).join('');

          container.innerHTML += `
            <div class="day-card">
              <div class="day-header">
                <h3>${diasNomes[diaKey]}</h3>
                <span style="font-size:12px; opacity:0.5;">${exercicios.length} exerc√≠cios</span>
              </div>
              <div class="table-responsive">
                <table class="treino-table">
                  <thead>
                    <tr>
                      <th>Exerc√≠cio</th>
                      <th>S√©ries</th>
                      <th>Reps</th>
                      <th>Carga</th>
                      <th>Desc.</th>
                      <th>T√©cnica / Obs</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${linhasTabela}
                  </tbody>
                </table>
              </div>
            </div>
          `;
        }
      });

      if(!encontrouTreino) {
        container.innerHTML = `
          <div style="text-align:center; padding:50px; opacity:0.5;">
            <i class="fa-solid fa-dumbbell" style="font-size:40px; margin-bottom:15px;"></i>
            <p>Seu treino est√° sendo preparado pela J√©ssica. Em breve aparecer√° aqui!</p>
          </div>
        `;
      }

    } else {
      container.innerHTML = `
        <div style="text-align:center; padding:50px; opacity:0.5;">
          <i class="fa-solid fa-calendar-check" style="font-size:40px; margin-bottom:15px;"></i>
          <p>Nenhum treino enviado para este e-mail ainda.</p>
        </div>
      `;
    }
  });
});

window.logout = function() {
  signOut(auth).then(() => { window.location.replace("login.html"); });
}

window.toggleMenu = function() {
  document.getElementById("sidebar").classList.toggle("active");
  document.getElementById("overlay").classList.toggle("active");
}
</script>

</body>
</html>