<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ãrea do Aluno</title>
<link rel="icon" href="logo.ico">

<style>
* { box-sizing: border-box; }

body {
  display: none; /* Mantido para proteÃ§Ã£o */
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0a0a14, #12081a, #2a0a1f);
  color: white;
  min-height: 100vh;
  overflow-x: hidden;
}

/* HEADER */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 18px;
  background: rgba(255,255,255,0.04);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.menu-btn {
  font-size: 22px;
  cursor: pointer;
  background: none;
  border: none;
  color: white;
}

.user-info { font-size: 16px; font-weight: 600; }

/* MENU LATERAL */
.sidebar {
  position: fixed;
  top: 0; left: 0;
  width: 240px;
  height: 100vh;
  background: rgba(15,15,25,0.95);
  backdrop-filter: blur(14px);
  border-right: 1px solid rgba(255,255,255,0.12);
  padding: 20px;
  transform: translateX(-100%);
  transition: 0.35s ease;
  z-index: 1000;
}

.sidebar.active { transform: translateX(0); }
.sidebar h3 { margin-bottom: 20px; font-size: 18px; }

.menu-item {
  padding: 12px 14px;
  border-radius: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: 0.2s;
  background: rgba(255,255,255,0.04);
}

.menu-item:hover { background: rgba(255,79,163,0.25); }

.logout {
  margin-top: 20px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.3);
  background: transparent;
  color: white;
  cursor: pointer;
  width: 100%;
}

/* OVERLAY */
.overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.6);
  opacity: 0;
  pointer-events: none;
  transition: 0.3s;
  z-index: 900;
}
.overlay.active { opacity: 1; pointer-events: all; }

/* CONTEÃšDO */
.dashboard {
  max-width: 1000px;
  margin: auto;
  padding: 25px;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 18px;
}

.card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 18px;
  padding: 20px;
  backdrop-filter: blur(12px);
  transition: 0.25s;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 20px 60px rgba(255,79,163,0.3);
}

.card h3 { margin-bottom: 10px; font-size: 18px; color: #ff4fa3; }
.card p { font-size: 14px; opacity: 0.9; line-height: 1.5; white-space: pre-wrap; }

.video-link {
    display: inline-block;
    margin-top: 15px;
    color: #ff4fa3;
    text-decoration: none;
    font-weight: bold;
    font-size: 13px;
    border: 1px solid #ff4fa3;
    padding: 5px 10px;
    border-radius: 8px;
}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h3>ğŸ“š Menu</h3>
  <div class="menu-item">ğŸ‹ï¸ Meu Treino</div>
  <div class="menu-item">ğŸ’³ Meu Plano</div>
  <div class="menu-item">ğŸ“Š EvoluÃ§Ã£o</div>
  <div class="menu-item">ğŸ’¬ Suporte</div>
  <button class="logout" onclick="logout()">Sair</button>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="topbar">
  <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
  <div class="user-info" id="userName">ğŸ‘‹ Carregando...</div>
</div>

<div class="dashboard">
  <div class="cards">
    <div class="card" id="cardTreino">
      <h3 id="treinoTitulo">ğŸ‹ï¸ Aguardando Treino...</h3>
      <p id="treinoDesc">O seu treinador ainda nÃ£o postou o treino de hoje.</p>
      <a href="#" id="treinoVideo" target="_blank" class="video-link" style="display: none;">ğŸ¥ Ver DemonstraÃ§Ã£o</a>
      <!-- ADICIONADO -->
      <a href="#" id="treinoPdf" target="_blank" class="video-link" style="display: none;">ğŸ“¥ Baixar Treino (PDF)</a>
    </div>

    <div class="card">
      <h3>ğŸ’³ Meu Plano</h3>
      <p id="userPlano">Verificando plano...</p>
    </div>

    <div class="card">
      <h3>ğŸ“… EvoluÃ§Ã£o</h3>
      <p>Acompanhe seu progresso e medidas aqui.</p>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import { getFirestore, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAKLvhy6r6tLSMIEt-mZcfHWuiKHHibdcY",
  authDomain: "meusiteteste1-7b880.firebaseapp.com",
  projectId: "meusiteteste1-7b880",
  storageBucket: "meusiteteste1-7b880.appspot.com",
  messagingSenderId: "107598819774",
  appId: "1:107598819774:web:1e369753c4b7908a6209ef"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  document.body.style.display = "block";
  const userEmail = user.email.toLowerCase(); // Chave para buscar o treino

  // 1. Buscar Nome e Plano do Aluno
  const userRef = doc(db, "users", user.uid);
  try {
    const userSnap = await getDoc(userRef);
    if (userSnap.exists()) {
      const data = userSnap.data();
      document.getElementById("userName").innerText = "ğŸ‘‹ OlÃ¡, " + (data.nome || "Aluno");
      document.getElementById("userPlano").innerText = "Plano atual: " + (data.plano || "BÃ¡sico");
    } else {
      document.getElementById("userName").innerText = "ğŸ‘‹ OlÃ¡, " + userEmail;
    }
  } catch (e) { console.error("Erro ao buscar dados do usuÃ¡rio"); }

  // 2. OUVIRE O TREINO PERSONALIZADO (A MÃGICA ACONTECE AQUI)
  const treinoRef = doc(db, "treinos", userEmail); 
  
  onSnapshot(treinoRef, (docSnap) => {
    const cardContainer = document.querySelector(".cards");
    
    if (docSnap.exists()) {
      const dados = docSnap.data();
      
      document.getElementById("treinoTitulo").innerText = "ğŸ‹ï¸ Meu Treino Personalizado";
      document.getElementById("treinoDesc").innerText = dados.instrucoes || "Siga o cronograma abaixo:";

      // ADICIONADO - PDF
      const pdfBtn = document.getElementById("treinoPdf");
      if (dados.pdfUrl) {
        pdfBtn.href = dados.pdfUrl;
        pdfBtn.style.display = "inline-block";
      } else {
        pdfBtn.style.display = "none";
      }

      const cardsAntigos = document.querySelectorAll('.card-dia-dinamico');
      cardsAntigos.forEach(c => c.remove());

      const dias = ["segunda", "terca", "quarta", "quinta", "sexta"];
      dias.forEach(dia => {
        if (dados.cronograma && dados.cronograma[dia] && dados.cronograma[dia].length > 0) {
          
          const listaExercicios = dados.cronograma[dia].map(ex => `
            <div style="margin-top:10px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:5px;">
              <strong>${ex.nome}</strong><br>
              <img src="${ex.arquivo}" style="width:100%; border-radius:8px; margin-top:5px;">
            </div>
          `).join('');

          const diaCard = document.createElement('div');
          diaCard.className = 'card card-dia-dinamico';
          diaCard.innerHTML = `
            <h3 style="text-transform: capitalize;">ğŸ“… ${dia}</h3>
            ${listaExercicios}
          `;
          cardContainer.appendChild(diaCard);
        }
      });

    } else {
      document.getElementById("treinoTitulo").innerText = "ğŸ‹ï¸ Sem treino ainda";
      document.getElementById("treinoDesc").innerText = "Seu treinador ainda estÃ¡ preparando seu plano personalizado.";
    }
  });
});

window.logout = function() {
  signOut(auth).then(() => { window.location.replace("login.html"); });
}

window.toggleMenu = function() {
  document.getElementById("sidebar").classList.toggle("active");
  document.getElementById("overlay").classList.toggle("active");
}
</script>
</body>
</html>
