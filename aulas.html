<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√Årea do Aluno</title>
<link rel="icon" href="logo.ico">

<style>
* { box-sizing: border-box; }

body {
  display: none; /* Mantido para prote√ß√£o */
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0a0a14, #12081a, #2a0a1f);
  color: white;
  min-height: 100vh;
  overflow-x: hidden;
}

/* HEADER */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 18px;
  background: rgba(255,255,255,0.04);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.menu-btn {
  font-size: 22px;
  cursor: pointer;
  background: none;
  border: none;
  color: white;
}

.user-info { font-size: 16px; font-weight: 600; }

/* MENU LATERAL */
.sidebar {
  position: fixed;
  top: 0; left: 0;
  width: 240px;
  height: 100vh;
  background: rgba(15,15,25,0.95);
  backdrop-filter: blur(14px);
  border-right: 1px solid rgba(255,255,255,0.12);
  padding: 20px;
  transform: translateX(-100%);
  transition: 0.35s ease;
  z-index: 1000;
}

.sidebar.active { transform: translateX(0); }
.sidebar h3 { margin-bottom: 20px; font-size: 18px; }

.menu-item {
  padding: 12px 14px;
  border-radius: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: 0.2s;
  background: rgba(255,255,255,0.04);
}

.menu-item:hover { background: rgba(255,79,163,0.25); }

.logout {
  margin-top: 20px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.3);
  background: transparent;
  color: white;
  cursor: pointer;
  width: 100%;
}

/* OVERLAY */
.overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.6);
  opacity: 0;
  pointer-events: none;
  transition: 0.3s;
  z-index: 900;
}
.overlay.active { opacity: 1; pointer-events: all; }

/* CONTE√öDO */
.dashboard {
  max-width: 1000px;
  margin: auto;
  padding: 25px;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 18px;
}

.card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 18px;
  padding: 20px;
  backdrop-filter: blur(12px);
  transition: 0.25s;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 20px 60px rgba(255,79,163,0.3);
}

.card h3 { margin-bottom: 10px; font-size: 18px; color: #ff4fa3; }
.card p { font-size: 14px; opacity: 0.9; line-height: 1.5; white-space: pre-wrap; }

.video-link {
    display: inline-block;
    margin-top: 15px;
    color: #ff4fa3;
    text-decoration: none;
    font-weight: bold;
    font-size: 13px;
    border: 1px solid #ff4fa3;
    padding: 5px 10px;
    border-radius: 8px;
}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h3>üìö Menu</h3>
  <div class="menu-item">üèãÔ∏è Meu Treino</div>
  <div class="menu-item">üí≥ Meu Plano</div>
  <div class="menu-item">üìä Evolu√ß√£o</div>
  <div class="menu-item">üí¨ Suporte</div>
  <button class="logout" onclick="logout()">Sair</button>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="topbar">
  <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
  <div class="user-info" id="userName">üëã Carregando...</div>
</div>

<div class="dashboard">
  <div class="cards">
    <div class="card" id="cardTreino">
      <h3 id="treinoTitulo">üèãÔ∏è Aguardando Treino...</h3>
      <p id="treinoDesc">O seu treinador ainda n√£o postou o treino de hoje.</p>
      <a href="#" id="treinoVideo" target="_blank" class="video-link" style="display: none;">üé• Ver Demonstra√ß√£o</a>
    </div>

    <div class="card">
      <h3>üí≥ Meu Plano</h3>
      <p id="userPlano">Verificando plano...</p>
    </div>

    <div class="card">
      <h3>üìÖ Evolu√ß√£o</h3>
      <p>Acompanhe seu progresso e medidas aqui.</p>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import { getFirestore, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAKLvhy6r6tLSMIEt-mZcfHWuiKHHibdcY",
  authDomain: "meusiteteste1-7b880.firebaseapp.com",
  projectId: "meusiteteste1-7b880",
  storageBucket: "meusiteteste1-7b880.appspot.com",
  messagingSenderId: "107598819774",
  appId: "1:107598819774:web:1e369753c4b7908a6209ef"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// üîê MONITOR √öNICO: Seguran√ßa + Dados
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  // Se chegou aqui, o usu√°rio existe
  document.body.style.display = "block";

  // 1. Buscar Nome e Plano do Aluno
  const userRef = doc(db, "users", user.uid);
  try {
    const userSnap = await getDoc(userRef);
    if (userSnap.exists()) {
      const data = userSnap.data();
      document.getElementById("userName").innerText = "üëã Ol√°, " + (data.nome || "Aluno");
      document.getElementById("userPlano").innerText = "Plano atual: " + (data.plano || "B√°sico");
    } else {
      document.getElementById("userName").innerText = "üëã Ol√°, " + user.email;
    }
  } catch (e) {
    console.error("Erro ao buscar dados do usu√°rio");
  }

  // 2. Ouvir o Treino em Tempo Real
  const treinoRef = doc(db, "treinos", "diario");
  onSnapshot(treinoRef, (docSnap) => {
    if (docSnap.exists()) {
      const treino = docSnap.data();
      document.getElementById("treinoTitulo").innerText = "üèãÔ∏è " + (treino.titulo || "Treino do Dia");
      document.getElementById("treinoDesc").innerText = treino.descricao || "Sem descri√ß√£o dispon√≠vel.";
      
      const btnVideo = document.getElementById("treinoVideo");
      if (treino.video) {
        btnVideo.href = treino.video;
        btnVideo.style.display = "inline-block";
      } else {
        btnVideo.style.display = "none";
      }
    }
  });
});

window.logout = function() {
  signOut(auth).then(() => {
    window.location.replace("login.html");
  });
}

window.toggleMenu = function() {
  document.getElementById("sidebar").classList.toggle("active");
  document.getElementById("overlay").classList.toggle("active");
}
</script>
    // C√≥digo para abrir o WhatsApp automaticamente ap√≥s vir da Anamnese
    window.addEventListener('load', function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('sendWhatsapp') === 'true') {
            const msg = encodeURIComponent("Ol√°, J√©ssica! Acabei de preencher minha ficha de anamnese no site.");
            const urlWhatsapp = `https://api.whatsapp.com/send?phone=5587996536247&text=${msg}`;
            
            // Tenta abrir o WhatsApp
            setTimeout(() => {
                window.open(urlWhatsapp, '_blank') || window.location.assign(urlWhatsapp);
            }, 1000);

            // Limpa o link para n√£o abrir de novo se o usu√°rio der F5
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    });
</script>
</body>
</html>